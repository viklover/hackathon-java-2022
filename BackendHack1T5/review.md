Хакатон. Backend Команды №5
==================

Backend взял на себя автор этого текста (Воробьев Михаил), а Садновников Артём написал `CSVReader`

Зависимости
-----------

Программа написана на Java с использованием фреймвора Maven и имеет следующие зависимости:
* `com.googlecode.json-simple` [`jsonsimple`] (1.1.1)
* `mysql` [`mysql-connector-java`] (8.0.25)
* `com.opencsv` [`opencsv`] (5.6)


Описание всех классов
---------------------

Backend состоит из следующих логических блоков:
* `DocumentManager` - класс, отвечающий за операции с экземплярами документов (создание, иницилизация, получение)
  * `Document` - экземляр документа
  * `DocumentType` - класс, который хранит информацию о типе документа (поля)
* `Database` - класс, предназначенный для исполнения SQL-запросов к MySQL БД
* `Server` - Http-сервер для обработки клиентских запросов
  * `RequestHandler` - обработчик запросов клиента
  * `ClientRequestHandler` - наследует класс выше
* `CSVReader` - класс предназначенный для чтения csv-таблицы и формирование её в класс JSONObject
* `Logger` - ведёт небольшой лог программы

Действия при запуске
--------------------

Какие действия выполняет программа при запуске:
1. Считывание конфигурационного файла, в котором хранятся:
  * Пользователь, пароль и ссылка к MySQL БД
  * Путь к директории с ресурсами относительно корневой папки проекта
2. Создание класса соединения к базе данных
3. Иницилизация всех `DocumentType` из <b>файла `types.json`</b>
3. Иницилизация всех экземпляров `Document`
4. Загрузка в систему всех csv-таблиц из директории ресурсов
5. Запуск HttpServer (на порту 8080)

Устройство MySQL
--------
Можно было бы сказать, что программа не имеет зависимости к определённой базе данных, если бы не хранение информации о всех типах в <b>файле `types.json`</b>. Если этот файл содержит в себе только пустой массив (json), а таблицы в базе отсутсвуют, то всё запуститься правильно (необходимые таблицы создаются при запуске).

Виды таблиц:
* `docs` - хранение информации о документах (id, id типа документа, название, текущая версия, путь к pdf и.т.д.)
* `docs_type<id_type>` - хранение всех полей документов определённого типа и их версий.

Загрузка csv-таблиц
-------------------
Пока на данный момент <u>загрузка файлов через клиента недоступна</u>. Единственный способ - положить csv-таблицу в папку с ресурсами (и перезагруить программу)

Если это новый тип сканированных документов, то к его названию будет присовено имя файла без расширения. 
Например, при загрузке файла `Заявления на поступление.csv` новому типу присвоится имя `Заявления на поступление`

Также при загрузке файлов должны соблюдаться следюущие условия:
1. Разделителем является `;`
2. Обязательно должна быть колонка `файл` (регистр не учитывается)


Инструкция по установке и запуску программы
-------------------------------------------
Программа имеет конфигурационный файл `config.json`, в котором необходимо указать следующие поля:
* `url` - ссылка к MySQL базе данных
* `user` - имя пользователя БД
* `password` - пароль пользователя
* `resources_directory` - путь к директории ресурсов относительно корневой папки Java-проекта

Запустив сервер, вы сможете зайти на html-страницу клиентской части.

P.S.
--

Мне в данный момент известны следующие проблемы моего кода:
* Формирование SQL-запроса происходит вне класса `Datatbase`, что приводит к грязному коду и забавным уязвимостям (кавычки в значении переменной). Все повторяющиеся алгоритмы определённо стоит разместить по отдельным функциям.
* Все типы документов хранятся в файле `types.json`, хотя их можно и нужно хранить в базе данных.
* Возможно иницилизация всех экземпляров документов из БД при запуске - не самое правильное решение, с точки зрения оптимизации работы программы.
* Класс, отвечающий за обработку клиентских запросов слишком большой, его точно стоит поделить на функции (или классы) по запросам

Что ещё мне хотелось бы добавить в мою программу:
* Использовние фрейморвка `Spring`

Что необходимо добавить в программу:
* Загрузка csv-таблиц через клиента

Несмотря на то, что при разработке у меня было представление, что и как делать, нужно было продумать всё изначально, так я бы смог избежать ошибок и сэкономить куча времени.

